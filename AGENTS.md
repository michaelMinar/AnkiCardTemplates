# Repository Guidelines

## Project Structure & Module Organization
- `templates/<template>/` — Anki HTML fragments with field placeholders (e.g., `order-of-operations/front.html`, `back.html`).
- `src/<template>/` — Testable JavaScript. Put shared logic in `index.js`; add `front.js`/`back.js` only when browser behaviors differ.
- `build/<template>/` — Build outputs to paste into Anki: `front.js` and `back.js` generated by `build.js`.
- `tests/<template>/` — Jest unit tests and fixtures; `tests/setup.js` mocks `document` and `localStorage`.
- Legacy examples at repo root (e.g., `dynamic-division/`, `rounding/`) are reference only; new work should follow `templates/` + `src/` + `tests/`.
- Utilities: `utils/` contains optional helpers not used by the build pipeline.

## Build, Test, and Development Commands
- Install: `npm ci` (CI) or `npm install` (local).
- Build: `npm run build` (runs `node build.js`) to emit `build/<template>/front.js` and `back.js` by inlining exports from `src` into template HTML.
- Test: `npm test` runs Jest in a Node environment with `tests/setup.js` loaded.
- Node version: 18.x (matches CI in `.github/workflows/test.yml`).

## Coding Style & Naming Conventions
- Language: JavaScript (Node). Use 4‑space indentation, semicolons, and camelCase for variables/functions.
- Directories: kebab-case (e.g., `order-of-operations`). Files: `index.js`, `front.js`, `back.js` in `src/<template>/`.
- Exports: CommonJS in `src` (`module.exports = { ... }`) to align with the build step.
- Keep `index.js` focused on pure, reusable functions; keep DOM access in `front.js`/`back.js`.

## Testing Guidelines
- Framework: Jest. Put tests under `tests/<template>/`.
- Naming: `test.js` or `<feature>.test.js` are both accepted.
- Environment: Tests run in Node; rely on `tests/setup.js` for `document`/`localStorage` mocks.
- Aim to cover edge cases (random generation bounds, formatting, evaluation errors). No coverage gate is enforced.

## Commit & Pull Request Guidelines
- Commits: short, imperative subjects (e.g., `add tests for exponents`, `refactor build to inline exports`). Group related changes.
- PRs: include a clear description, rationale, and, when relevant, screenshots of rendered cards. Link related issues.
- Validation: ensure `npm test` and `npm run build` pass locally. Target `main`; CI runs tests on PRs.

## Security & Configuration Tips
- Do not commit secrets. Avoid network calls in templates/build.
- Changes to `build.js` should remain deterministic and not execute untrusted input.
- Prefer small, focused PRs; keep changes consistent with existing style.

## Agent-Specific Instructions
- The maintainer reviews unstaged changes before staging. Do not run `git add`, `git commit`, `git push`, or create PRs. You may pull (`git fetch/pull`) to sync and edit files locally; leave all changes unstaged for manual review.
- Clearly summarize edited file paths and intent after changes. Keep diffs minimal and scoped to the request.
